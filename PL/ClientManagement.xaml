<Window x:Class="Heyam.ClientManagement"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"                   
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:local="clr-namespace:Heyam"
        mc:Ignorable="d"
        ResizeMode="NoResize"
        WindowStyle="None"
        WindowStartupLocation="CenterScreen"
        AllowsTransparency="True"
        Title="مدیریت موکلین" Height="710" Width="900" Background="#F5F5F5" FontFamily="pack://application:,,,/Resources/Fonts/#IRANSansWeb(FaNum)" FlowDirection="RightToLeft">
    <Grid x:Name="MainGrid">
        <!-- Header -->
        <Border Background="#1259D5" Height="80" VerticalAlignment="Top">
            <TextBlock Text="سیستم مدیریت موکل ها" Foreground="White" FontSize="24" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
        </Border>
        <!-- Tab Control -->
        <TabControl Margin="20,100,20,20">
            <!-- Tab: ثبت موکل جدید -->
            <TabItem Header="ثبت موکل جدید" Cursor="Hand">
                <Grid Background="White">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="33*"/>
                        <ColumnDefinition Width="15*"/>
                        <ColumnDefinition Width="57*"/>
                        <ColumnDefinition Width="20*"/>
                        <ColumnDefinition Width="12*"/>
                        <ColumnDefinition Width="15*"/>
                        <ColumnDefinition Width="21*"/>
                        <ColumnDefinition Width="43*"/>
                        <ColumnDefinition Width="5*"/>
                        <ColumnDefinition Width="637*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel x:Name="RegisterPanel" Margin="20,20,20,20" Grid.ColumnSpan="10">
                        <TextBlock Text="نام و نام خانوادگی" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="FullNameTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1" />

                        <TextBlock Text="نام پدر" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="FatherNameTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1" />

                        <TextBlock Text="کد ملی" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="NationalCodeTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1" />

                        <TextBlock Text="تاریخ تولد" FontSize="14" Foreground="#555" />
                        <hc:PersianDatePicker x:Name="BirthDateDP" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1"/>

                        <TextBlock Text="تلفن همراه" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="PhoneNumberTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1"/>

                        <TextBlock Text="ایمیل (اختیاری)" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="EmailTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1" TextChanged="EmailTB_TextChanged"/>
                        <TextBlock x:Name="EmailErrorTextBlock" Foreground="Red"
                        Visibility="Collapsed"
                        Margin="5,0,10,10"
                        Text="فقط حروف انگلیسی مجاز است!" />
                        <TextBlock Text="آدرس محل سکونت" FontSize="14" Foreground="#555" />
                        <TextBox x:Name="AddressTB" Height="35" Padding="5" FontSize="14" BorderBrush="#DDD" BorderThickness="1"/>

                        <TextBlock Text="جنسیت" Foreground="#333" FontSize="14" Margin="5,0" />
                        <ComboBox x:Name="GenderCB" Width="100" HorizontalAlignment="Left">
                            <ComboBoxItem IsSelected="True">مرد</ComboBoxItem>
                            <ComboBoxItem>زن</ComboBoxItem>
                        </ComboBox>

                        <Button x:Name="SubmitClientBTN" Content="ثبت موکل" Height="35" Width="150" Background="ForestGreen" Foreground="White" HorizontalAlignment="Left" Margin="0,23,0,0" Cursor="Hand" Click="SubmitClientBTN_Click"/>
                    </StackPanel>

                    <!-- جدول اطلاعات موکل‌ها -->
                    <DataGrid x:Name="ClientsDGV" AutoGenerateColumns="False" IsReadOnly="True" CanUserResizeColumns="True" Visibility="Collapsed" Margin="0,10,0,62" Grid.ColumnSpan="10">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="کاربر" Width="55">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding UserTypeText}" Foreground="{Binding UserTypeColor}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="نام موکل" Binding="{Binding FullName}" Width="200"/>
                            <DataGridTextColumn Header="نام پدر" Binding="{Binding FatherName}" Width="*"/>
                            <DataGridTextColumn Header="کد ملی" Binding="{Binding NationalCode}" Width="*"/>
                            <DataGridTextColumn Header="تلفن همراه" Binding="{Binding PhoneNumber}" Width="*"/>
                            <DataGridTextColumn Header="جنسیت" Binding="{Binding Gender}" Width="100"/>
                            <!-- ستون دکمه نمایش جزئیات -->
                            <DataGridTemplateColumn Header="مشاهده جزئیات" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button x:Name="ShowClientDetailsBTN" Content="👁 مشاهده" 
                                        Tag="{Binding Id}" Cursor="Hand" Click="ShowClientDetailsBTN_Click" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- پاپ‌آپ و نمایش جزئیات -->
                    <Popup x:Name="ClientDetailsPopup"
                      Placement="Center"
                      StaysOpen="True"
                      AllowsTransparency="True"
                      PopupAnimation="None"
                      Opened="ClientDetailsPopup_Opened"
                      Closed="ClientDetailsPopup_Closed">

                        <Border Background="White" Padding="15" CornerRadius="10" BorderBrush="Black" BorderThickness="3" Width="500" Height="450">
                            <StackPanel>
                                <TextBlock Text="📜 مشخصات موکل" FontSize="18" FontWeight="Bold" Foreground="DarkBlue" Margin="0,0,0,10"/>
                                <TextBlock Text="کد ملی:" FontWeight="Bold" Visibility="Collapsed"/>
                                <TextBlock x:Name="NationalCodeHiddenText" Text="{Binding NationalCode}" Visibility="Collapsed" Foreground="Purple" FontSize="16" />
                                <TextBlock Text="تاریخ تولد:" FontWeight="Bold"/>
                                <TextBlock x:Name="BirthDateText" Text="{Binding BirthDate}" Foreground="Purple" FontSize="16" />
                                <TextBlock Text="تلفن همراه:" FontWeight="Bold"/>
                                <TextBox x:Name="PhoneNumberText" Text="{Binding PhoneNumber}" Foreground="Purple" FontSize="14"/>
                                <TextBlock Text="ایمیل:" FontWeight="Bold"/>
                                <TextBox x:Name="EmailText" Text="{Binding Email}" Foreground="Purple" FontSize="14" TextChanged="EmailText_TextChanged"/>
                                <TextBlock x:Name="EmailErrorTextPopup" Foreground="Red"
                                            Visibility="Collapsed"
                                            Margin="5,0,10,10"
                                            Text="فقط حروف انگلیسی مجاز است!" />
                                <TextBlock Text="آدرس:" FontWeight="Bold" Margin="0,10,0,0"/>
                                <TextBox x:Name="AddressText" Text="{Binding Address}" TextWrapping="Wrap" Height="150" VerticalContentAlignment="Top" VerticalScrollBarVisibility="Visible"/>
                                <WrapPanel HorizontalAlignment="Right" Margin="0,10,10,380" Width="205">
                                    <Button x:Name="ClientDetailsPopupUpdateBTN" Content="✅ ذخیره ویرایش" Background="#1259D5" Foreground="White" Cursor="Hand" Height="30" Click="ClientDetailsPopupUpdateBTN_Click" />
                                    <Button x:Name="ClientDetailsPopupCloseBTN" Content="❌ بستن" Background="Crimson" Foreground="White" Cursor="Hand" Margin="20 0 0 0" Height="30" Click="ClientDetailsPopupCloseBTN_Click"/>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                    </Popup>

                    <!-- دکمه تغییر حالت -->
                    <Button x:Name="ShowHide_ClientListBTN" Content="نمایش/پنهان‌سازی لیست موکل‌ها" Height="35" Width="200" Background="#03A9F4" Foreground="White" HorizontalAlignment="Left" Margin="10,501,0,0" VerticalAlignment="Top" Cursor="Hand" Grid.Column="9" Click="ShowHide_ClientListBTN_Click" />
                    <hc:SearchBar x:Name="SearchClient" Visibility="Collapsed" Grid.Column="9" HorizontalAlignment="Left" Margin="261,504,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Width="247" TextChanged="SearchClient_TextChanged"/>
                    <TextBlock x:Name="SearchPlaceholderText" Visibility="Collapsed"
                       Text="جستجو براساس نام موکل یا کد ملی ..."
                       Foreground="Gray"                                          
                       IsHitTestVisible="False" Grid.Column="9" HorizontalAlignment="Left" Margin="272,509,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Width="300"/>
                    <DockPanel x:Name="GenderFilterPanel" Margin="10,503,3,24" Grid.ColumnSpan="9" Visibility="Collapsed">
                        <TextBlock Text="فیلتر براساس جنسیت:" Height="20"/>
                        <ComboBox x:Name="GenderFilterComboBox" SelectedValuePath="Tag"
                                  SelectionChanged="GenderFilterComboBox_SelectionChanged" Width="80">
                            <ComboBoxItem Content="همه" Tag="" IsSelected="True"/>
                            <ComboBoxItem Content="مرد" Tag="مرد"/>
                            <ComboBoxItem Content="زن" Tag="زن"/>
                        </ComboBox>
                    </DockPanel>
                </Grid>
            </TabItem>

            <!-- Tab: مدیریت تعاملات -->
            <TabItem Header="مدیریت تعاملات" Cursor="Hand">
                <Grid Background="White" Margin="0 15 0 0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="56*"/>
                        <RowDefinition Height="103*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="2*" />
                    </Grid.ColumnDefinitions>
                    <!-- Input Fields -->
                    <StackPanel Grid.Column="0" Margin="0,0,20,0" Grid.RowSpan="2" >
                        <TextBlock Text="انتخاب موکل" FontSize="14" Foreground="#333" />
                        <ComboBox x:Name="SelectClientInteractionCB" IsEditable="True" Height="35" Padding="5" FontSize="14" Background="White" BorderBrush="Gray" BorderThickness="1"/>

                        <TextBlock Text="نوع تعامل" FontSize="14" Foreground="#333" />
                        <ComboBox x:Name="InteractionTypeCB" Height="35" FontSize="14" Background="White" BorderBrush="Gray" BorderThickness="1" >
                            <ComboBoxItem Content="تماس تلفنی" />
                            <ComboBoxItem Content="ایمیل" />
                            <ComboBoxItem Content="جلسه حضوری" />
                        </ComboBox>

                        <TextBlock Text="تاریخ تعامل" FontSize="14" Foreground="#333" />
                        <hc:PersianDateTimePicker x:Name="InteractionDateDTP" Height="35" FontSize="14" Background="White" BorderBrush="Gray" BorderThickness="1"  />
                        <TextBlock Text="برای ثبت تعامل، فیلد تاریخ تعامل را حداقل یکبار تایید کنید" FontSize="10" FontWeight="Bold" Foreground="Crimson"/>

                        <!-- استایل سفارشی چک‌باکس -->
                        <CheckBox x:Name="ReminderCheckBox"
                        Content="یادآوری برای تعامل بعدی؟"
                        FontSize="12"
                        FontWeight="Bold"
                        Foreground="#1051E7"
                        Width="166" Height="33" Margin="-100 10 0 0"
                        Checked="chkReminder_Checked"
                        Unchecked="chkReminder_Unchecked">

                            <CheckBox.Style>
                                <Style TargetType="CheckBox">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="CheckBox">
                                                <StackPanel Orientation="Horizontal">
                                                    <!-- دایره چک‌باکس -->
                                                    <Border Width="20" Height="20" Cursor="Hand"
                                                     CornerRadius="12"
                                                     Background="White" 
                                                     BorderBrush="#4A90E2" 
                                                     BorderThickness="2">
                                                        <Ellipse Fill="#4A90E2"
                                                         Width="12"
                                                         Height="12"
                                                         VerticalAlignment="Center"
                                                         HorizontalAlignment="Center"
                                                         Visibility="Collapsed"
                                                         x:Name="CheckMark"/>
                                                    </Border>
                                                    <!-- متن چک‌باکس -->
                                                    <ContentPresenter Margin="10,0,0,0"
                                                     VerticalAlignment="Center"/>
                                                </StackPanel>
                                                <ControlTemplate.Triggers>
                                                    <!-- حالت انتخاب -->
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </CheckBox.Style>
                        </CheckBox>
                        <hc:PersianDateTimePicker Text="" x:Name="ReminderDateTimeDTP" IsEnabled="False" Margin="5,-3,0,20"/>
                    </StackPanel>

                    <TextBlock Text="یادداشت (+ برای یادآوری ⏰)" FontSize="14" Foreground="#333" Margin="0,69,0,256" Grid.Row="1" />
                    <TextBox x:Name="NotesTB" Margin="0,101,0,72" Padding="5" FontSize="14" VerticalContentAlignment="Top" VerticalScrollBarVisibility="Visible" TextWrapping="Wrap" AcceptsReturn="True" Background="White" BorderBrush="Gray" BorderThickness="1" RenderTransformOrigin="0.5,0.5" Grid.Row="1"  >
                        <TextBox.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform/>
                                <SkewTransform AngleX="0.47"/>
                                <RotateTransform/>
                                <TranslateTransform X="-0.492"/>
                            </TransformGroup>
                        </TextBox.RenderTransform>
                    </TextBox>

                    <!-- Interaction List -->
                    <StackPanel Grid.Column="1" Grid.RowSpan="2" Margin="0,0,0,79" >
                        <TextBlock Text="لیست تعاملات" FontSize="14" Foreground="#333" />
                        <ListView x:Name="InteractionsListView">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="کاربر" Width="70">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding UserTypeText}" Foreground="{Binding UserTypeColor}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="نام موکل" DisplayMemberBinding="{Binding ClientName}" Width="140"/>
                                    <GridViewColumn Header="تاریخ تعامل" DisplayMemberBinding="{Binding InteractionDate}" Width="120"/>
                                    <GridViewColumn Header="یادآوری دارد؟" DisplayMemberBinding="{Binding IsReminderSet}" Width="90"/>
                                    <GridViewColumn Header="🔍 مشاهده جزئیات" Width="120">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button x:Name="ShowInteractionDetails" Content="👁 مشاهده" Tag="{Binding Id}" Click="ShowInteractionDetails_Click"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>

                    <!-- پاپ‌آپ و نمایش جزئیات -->
                    <Popup x:Name="InteractionsDetailsPopup"
                            Placement="Center"
                            StaysOpen="True"
                            AllowsTransparency="True"
                            PopupAnimation="None"
                            Opened="InteractionsDetailsPopup_Opened"
                            Closed="InteractionsDetailsPopup_Closed">

                        <Border Background="White" Padding="15" CornerRadius="10" BorderBrush="Black" BorderThickness="3" Width="500" Height="415">
                            <StackPanel>
                                <TextBlock Text="📜 جزئیات تعامل" FontSize="18" FontWeight="Bold" Foreground="DarkBlue" Margin="0,0,0,10"/>
                                <TextBlock Text="نوع تعامل:" FontWeight="Bold"/>
                                <TextBox x:Name="InteractionType" TextWrapping="Wrap"/>
                                <TextBlock Text="یادداشت:" FontWeight="Bold"/>
                                <TextBox x:Name="InteractionNote" TextWrapping="Wrap" Height="150" VerticalContentAlignment="Top" VerticalScrollBarVisibility="Visible" />
                                <Separator/>
                                <CheckBox x:Name="ReminderCheckBoxPopup" Content="یادآوری فعال شود؟" Margin="0 10" FontWeight="Bold" Checked="ReminderCheckBoxPopup_Checked" Unchecked="ReminderCheckBoxPopup_Unchecked"/>
                                <hc:PersianDatePicker x:Name="ReminderDatePopup" IsEnabled="False" Margin="5,-3,0,20"/>

                                <WrapPanel HorizontalAlignment="Right" Margin="0,0,10,380" Width="205">
                                    <Button x:Name="w" Content="✅ ذخیره تغییرات" Background="#1259D5" Foreground="White" Cursor="Hand" Height="30" Click="InteractionSaveChangesBTN_Click" />
                                    <Button x:Name="e" Content="❌ بستن" Background="Crimson" Foreground="White" Cursor="Hand" Margin="20 0 0 0" Height="30" Click="InteractionClosePopupBTN_Click"/>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                    </Popup>

                    <!-- Buttons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,220,0,0" Grid.Row="1" Width="274" >
                        <Button x:Name="AddInteractionsBTN" Content="افزودن تعامل" Margin="0 65 0 0" Width="125" Height="40" Background="ForestGreen" Foreground="White" FontSize="14" BorderThickness="0" Click="AddInteractionsBTN_Click"/>
                    </StackPanel>
                    <hc:SearchBar x:Name="SearchInteractions" BorderBrush="Gray" Grid.Column="1" Margin="0,280,0,0" HorizontalAlignment="Center" Grid.Row="1" TextWrapping="Wrap" VerticalAlignment="Top" Width="552" TextChanged="SearchInteractions_TextChanged"/>
                    <TextBlock x:Name="InteractionsPlaceholderText"
                       Text="جستجو براساس نام موکل ..."
                       Foreground="Gray"
                       VerticalAlignment="Top"
                       Margin="20,284,0,0"
                       IsHitTestVisible="False" Grid.Column="1" HorizontalAlignment="Left" Grid.Row="1" TextWrapping="Wrap" Width="502"/>
                </Grid>
            </TabItem>
        </TabControl>
        <Button x:Name="CloseBTN" Background="#4068FA" Foreground="White" Content="برگشت" Width="100" Height="31" Cursor="Hand" Margin="767,651,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Click="CloseBTN_Click" />
    </Grid>
</Window>